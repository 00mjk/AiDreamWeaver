(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[28],{8181:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var r=n(7568),i=n(6042),s=n(9396),a=n(9815),l=n(655),o=n(5893),u=n(9830),d=n(9669),c=n.n(d),f=n(2337),h=n(7294),m=n(8533),p=n(628),g=n(3344),x=function(){var e=(0,g.Z)(),t=(0,h.useState)(0),n=t[0],r=t[1],i=(0,h.useCallback)(function(){e&&r(window.innerWidth)},[e]);return(0,h.useLayoutEffect)(function(){if(e)return window.addEventListener("resize",i),i(),function(){return window.removeEventListener("resize",i)}},[e,i]),{width:n,hasMounted:e}},v=function(e){var t=e.columnsCountBreakPoints,n=e.children,r=e.className,i=e.style,s=x(),a=s.width,l=s.hasMounted,u=(0,h.useMemo)(function(){var e=Object.keys(t).sort(function(e,t){return parseInt(e)-parseInt(t)}),n=e.length>0?t[e[0]]:1;return e.forEach(function(e){parseInt(e)<a&&(n=t[e])}),n},[a,t]);return(0,o.jsx)("div",{className:r,style:i,children:l?h.Children.map(n,function(e,t){return h.cloneElement(e,{key:t,columnsCount:u})}):null})},y=n(1163),j=n(4108),w=n(3299),b={300:1,400:2,800:3,1200:4,1600:5};function _(e){var t,n,d,x=e.initialImages,_=e.initialCursor,k=e.options,I=e.sortBy,N=e.emptyState,C=e.groupBatchedImages,S=void 0!==C&&C,L=e.hideProfileImages,P=void 0!==L&&L,Z=e.scrollThreshold,E=(0,h.useState)(x),B=E[0],M=E[1],O=(0,h.useState)(_),U=O[0],R=O[1],D=(0,h.useState)(!1),A=D[0],T=D[1],q=(0,h.useState)(null),F=q[0],K=q[1],V=(0,w.useSession)(),H=(0,y.useRouter)(),J=(0,h.useRef)({sortBy:I}),z=(0,j.g)().setImageData;(0,h.useEffect)(function(){var e,t=!1,n=(e=(0,r.Z)(function(){var e,n,r;return(0,l.__generator)(this,function(i){switch(i.label){case 0:return T(!0),[4,X(0)];case 1:return n=(e=i.sent()).newImages,r=e.newCursor,t||(R(r),M(n),T(!1)),[2]}})}),function(){return e.apply(this,arguments)});return J.current.sortBy!==I&&(J.current.sortBy=null,n()),function(){t=!0}},[I]);var G,W,X=(0,h.useCallback)((d=(0,r.Z)(function(e){var t,n,r,s,a,o;return(0,l.__generator)(this,function(r){switch(r.label){case 0:return[4,c().get(k.url,{params:(0,i.Z)({limit:u.NM,cursor:e,userId:null==V?void 0:null===(t=V.data)||void 0===t?void 0:null===(n=t.user)||void 0===n?void 0:n.id},k.params)})];case 1:return[2,{newImages:a=(s=r.sent().data).images,newCursor:s.cursor}]}})}),function(e){return d.apply(this,arguments)}),[k.params,k.url,null==V?void 0:null===(t=V.data)||void 0===t?void 0:null===(n=t.user)||void 0===n?void 0:n.id]),Q=(0,h.useCallback)((0,r.Z)(function(){var e,t,n;return(0,l.__generator)(this,function(n){switch(n.label){case 0:return[4,X(U)];case 1:return t=(e=n.sent()).newImages,R(e.newCursor),setTimeout(function(){return M(function(e){return(0,a.Z)(e).concat((0,a.Z)(t))})},0),[2,t]}})}),[U,X]),Y=(0,h.useCallback)((G=(0,r.Z)(function(e,t){var n,r,i,s=arguments;return(0,l.__generator)(this,function(a){return n=!(s.length>2)||void 0===s[2]||s[2],r=s.length>3&&void 0!==s[3]&&s[3],K(t),z(e),i=e.id,H.query.postId=i,r&&H.push(H,"/post/".concat(i),{shallow:!0}),n&&localStorage.setItem("modal-return-to",H.asPath),[2]})}),function(e,t){return G.apply(this,arguments)}),[H,z]),$=(0,g.Z)(),ee=(0,h.useMemo)(function(){var e=[];return B.forEach(function(t){if(!t.hide){var n=e.find(function(e){return e.id===t.batchId});n?n.images.length<4&&n.images.push(t):e.push({id:S&&t.batchId?t.batchId:t.id,images:[t]})}}),e},[B,S]),et=(0,h.useCallback)((W=(0,r.Z)(function(e){var t,n,r,i;return(0,l.__generator)(this,function(s){switch(s.label){case 0:if(!(null!==F)||((t=F+e)>=0&&t<B.length&&(null===(n=ee[t].images)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.id)&&Y(null===(i=ee[t].images)||void 0===i?void 0:i[0],t,!1,!0),!(t>=B.length-2)))return[3,2];return[4,Q()];case 1:s.sent(),s.label=2;case 2:return[2]}})}),function(e){return W.apply(this,arguments)}),[ee,Q,B.length,Y,F]);(0,h.useEffect)(function(){var e,t=(e=(0,r.Z)(function(e){var t;return(0,l.__generator)(this,function(n){return["ArrowLeft","ArrowRight"].includes(null===(t=e.key)||void 0===t?void 0:t.toString())&&(null==H?void 0:H.query.postId)&&et("ArrowRight"===e.key?1:-1),[2]})}),function(t){return e.apply(this,arguments)});return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}},[B,et,null==H?void 0:H.query.postId,F]),(0,h.useEffect)(function(){var e=function(){return et(1)},t=function(){return et(-1)};return document.addEventListener("pai:modal:next",e),document.addEventListener("pai:modal:prev",t),function(){document.removeEventListener("pai:modal:next",e),document.removeEventListener("pai:modal:prev",t)}},[et]);var en=(0,h.useMemo)(function(){return B.some(function(e){return e.hide})},[B]);return $?(0,o.jsx)(m.Z,{dataLength:B.length,next:Q,hasMore:void 0!==U,loader:(0,o.jsx)(o.Fragment,{}),style:{overflow:"visible"},scrollThreshold:void 0===Z?.8:Z,children:(0,o.jsx)(v,{columnsCountBreakPoints:b,children:ee.length&&!A?(0,o.jsx)(f.Z,{gutter:"16px",children:ee.map(function(e,t){var n=Math.min(e.images.length,2);return(0,o.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:"repeat(".concat(n,", minmax(0, 1fr))")},children:e.images.map(function(e,r){var a,l,u;return(0,o.jsx)(p.F,{id:e.id,aspectRatio:(null!==(a=e.width)&&void 0!==a?a:1)/(null!==(l=e.height)&&void 0!==l?l:1),prompt:n>1?"":e.prompt,url:null!==(u=e.url_jpeg)&&void 0!==u?u:e.url,title:e.title,isPrivate:e.private,source:e.source,user:{id:e.user.id,name:e.user.displayName,avatar:e.user.image},hideImage:P,reaction:e.ImageReaction,onClick:function(n){n.metaKey||Y(e,t)},setHidden:function(t,n){var r=n||[e.id];M(function(e){return e.map(function(e){return r.includes(e.id)?(0,s.Z)((0,i.Z)({},e),{hide:t}):e})})},forceVisible:en,parent_image_url:e.parent_image_url},e.id)})},e.id)})}):(0,o.jsx)("p",{className:"text-gray-400 p-10",children:N||A||"No images."})})}):null}},4028:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return U},default:function(){return R},sharedGetServerSideProps:function(){return K}});var r=n(7568),i=n(828),s=n(655),a=n(5893),l=n(2211),o=n(6057),u=n(8057),d=n.n(u),c=n(3299),f=n(8181),h=n(9830),m=n(7294),p=n(5882),g=n(1664),x=n.n(g),v=n(3965),y=n(979),j=n(4633),w=n(8891),b=n.n(w),_=function(e){var t=e.userId,n=e.link,r=e.setLink,i=(0,m.useState)(n),s=i[0],l=i[1],o=(0,m.useState)(""),u=o[0],c=o[1],f=(0,j.pm)(),h=(0,v.d)(),p=(0,m.useCallback)(function(){try{var e=function(e){if(!(e=e.trim()).length)return"";if(e.includes("://")||(e="http://"+e),!["http","https"].includes(e.split("://")[0]))throw Error("Only http and https URLs are allowed");try{return new URL(e).toString()}catch(t){throw Error("URL not valid")}}(s);c(""),l(e);var i=new URL("/api/user",window.location.origin);i.searchParams.set("id",t),fetch(i.toString(),{method:"PATCH",body:JSON.stringify({link:e})}).then(function(e){if(200===e.status){b().track("Saved profile link");return}throw Error()}).catch(function(e){console.error(e),r(n),f("Couldn't update link")}),r(e),h.closeModal()}catch(a){c(a.message);return}},[f,t,s,n,r,h]);return(0,a.jsxs)("div",{className:"bg-gray-90 h-auto w-[90vw] md:w-[500px] flex flex-col text-sm text-gray-25",children:[(0,a.jsx)("header",{className:"py-4 px-8 border-b border-gray-85",children:(0,a.jsx)("h1",{className:"title-primary",children:"Add a link to your profile"})}),(0,a.jsx)("div",{className:"h-full flex justify-start p-8",children:(0,a.jsxs)("div",{className:"flex flex-col w-full gap-y-2",children:[(0,a.jsx)("p",{children:"Link to your personal website, portfolio, or social media account"}),(0,a.jsx)("div",{children:(0,a.jsx)(y.BZ,{className:d().profile__add_link_input,children:(0,a.jsx)(y.II,{placeholder:"Enter URL",className:"!bg-gray-95",value:s,onChange:function(e){return l(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),p())},autoFocus:!0})})}),u&&(0,a.jsx)("div",{className:"text-dark-pink flex justify-start",children:u})]})}),(0,a.jsx)("footer",{className:"border-t border-gray-85",children:(0,a.jsxs)("div",{className:"flex justify-end py-6 px-8 gap-4",children:[(0,a.jsx)("button",{className:"button button-secondary",onClick:function(){h.closeModal()},children:"Cancel"}),(0,a.jsx)("button",{className:"button button-primary border-none",onClick:p,disabled:!n&&0===s.length,children:n&&!s&&"Remove"||"Save"})]})})]})},k=n(6094),I=n(1763),N=n(6511),C=function(e){var t=e.name,n=e.userId,r=e.likeCount,i=e.avatar,s=e.followerIds,l=e.followingIds,o=e.currentUserId,u=e.userLink,c=e.isOwnProfile;(0,N.ye)();var f,h,g=(0,m.useState)(s.includes(o)),y=g[0],j=g[1],w=(0,m.useState)(s.length),b=w[0],C=w[1],S=function(){C(b+1),j(!0)},L=function(){C(b-1),j(!1)},P=(0,m.useState)(u),Z=P[0],E=P[1],B=(0,v.d)(),M=(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:d().profile__header_friendship_count+" flex gap-y-2 gap-x-8 md:gap-x-4",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-bold",children:b}),"\xa0","follower".concat(1==b?"":"s")]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-bold",children:l.length}),"\xa0following"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-bold",children:r||0}),"\xa0likes"]})]}),(Z||c)&&(0,a.jsx)("div",{className:"flex gap-y-2 gap-x-8 md:gap-x-4 mt-2 justify-center md:justify-start",children:(0,a.jsx)("p",{children:Z?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("a",{href:Z,target:"_blank",rel:"noreferrer noopener",className:"!inline-block text-button align-middle",children:[(0,a.jsx)(k.Z,{className:"!inline-block align-middle mr-1",width:18,height:18}),(0,a.jsx)("span",{className:"inline-block align-middle font-normal text-[0.9375rem]",children:(h=Z.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")).endsWith("/")?h.slice(0,-1):h})]}),c&&(0,a.jsx)(x(),{href:"#",target:"_blank",className:"inline-block align-middle",children:(0,a.jsx)("button",{className:"text-gray-50 !inline-block align-middle ml-3 hover:text-gray-25 transition-colors",type:"submit",onClick:function(e){e.stopPropagation(),B.setModalContent((0,a.jsx)(_,{userId:n,link:Z,setLink:E}),{transitionModal:!0})},children:(0,a.jsx)("span",{className:"!inline-block align-middle hover:text-white",children:(0,a.jsx)(I.Z,{width:18,height:18})})})})]}):c&&(0,a.jsx)(x(),{href:"#",children:(0,a.jsxs)("button",{className:"text-button",type:"submit",onClick:function(e){e.stopPropagation(),B.setModalContent((0,a.jsx)(_,{userId:n,link:"",setLink:E}),{transitionModal:!0})},children:[(0,a.jsx)(k.Z,{className:"!inline-block align-middle mr-1",width:18,height:18}),(0,a.jsx)("span",{className:"inline-block align-middle text-[0.9375rem] font-normal",children:"Add Link"})]})})})})]});return(0,a.jsxs)("div",{className:"p-5 bg-[url('/images/banner.png')]",children:[(0,a.jsxs)("div",{className:"flex gap-x-5 items-center",children:[(0,a.jsx)("img",{src:i,alt:"".concat(t," avatar"),className:"!aspect-square flex-none rounded-md w-20 h-20 md:w-[100px] md:h-[100px]"}),(0,a.jsxs)("div",{className:"flex flex-col justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-3 md:gap-4 flex-grow items-start md:items-center flex-col md:flex-row",children:[(0,a.jsx)("h3",{className:"font-semibold text-3xl text-white",children:t}),(0,a.jsx)("div",{className:"flex",children:o!=n&&(0,a.jsx)(p.Z,{isFollowing:y,userId:n,name:t,handleFollow:S,handleUnfollow:L})})]}),(0,a.jsx)("div",{className:"hidden md:block",children:M})]})]}),(0,a.jsx)("div",{className:"flex justify-center pt-3 md:hidden",children:M})]})},S=n(8034),L=n(7026),P=n(3262),Z=n(6118),E=function(e){var t=e.userId,n=e.tab,r=e.sortBy,i=e.setSortBy,s=e.showTabs,l=Object.keys(o.Dt).indexOf(n),u=(0,m.useState)(!0),c=u[0],f=u[1];return(0,m.useEffect)(function(){(0,N.BD)()&&f(!0)},[]),c&&(0,a.jsxs)("div",{className:"flex justify-between p-5 pb-0 flex-col sm:flex-row gap-5",children:[(0,a.jsx)("div",{children:s&&(0,a.jsx)(S.mQ,{variant:"soft-rounded",colorScheme:"gray",defaultIndex:l||0,children:(0,a.jsxs)(S.td,{className:d().tabs,style:{gap:"5px"},children:[(0,a.jsx)(x(),{href:"/profile/"+t,children:(0,a.jsxs)(S.OK,{style:{display:"flex",flexDirection:"row",gap:"8px"},children:[(0,a.jsx)(P.Z,{}),"My Images"]})}),(0,a.jsx)(x(),{href:"/profile/likes/"+t,children:(0,a.jsxs)(S.OK,{style:{display:"flex",flexDirection:"row",gap:"8px"},children:[(0,a.jsx)(Z.Z,{}),"My Likes"]})})]})})}),(0,a.jsx)("div",{children:(0,a.jsxs)(L.Ph,{color:"white",value:r,onChange:function(e){b().track("Sorted profile",{sortBy:e.currentTarget.value}),i(e.currentTarget.value)},children:[(0,a.jsx)("option",{className:"text-gray-800",value:o.I5.Newest,children:"Newest"}),(0,a.jsx)("option",{className:"text-gray-800",value:o.I5.Oldest,children:"Oldest"}),(0,a.jsx)("option",{className:"text-gray-800",value:o.I5.MostLiked,children:"Most Liked"})]})})]})},B=n(9008),M=n.n(B),O=n(1163),U=!0;function R(e){var t,n=e.user,r=e.initialImages,i=e.likeCount,s=e.currentUserId,u=e.followerIds,h=e.followingIds,p=e.initialCursor,g=(e.sessionData,e.tab),x=e.isOwnProfile,v=(0,m.useRef)(null),y=r.reduce(function(e,t){return t.likeCount>e.likeCount?t:e},r[0]),j=(0,m.useState)(o.I5.Newest),w=j[0],_=j[1];(0,m.useEffect)(function(){b().track("Viewed profile",{tab:g})},[n.id,g]);var k=(0,c.useSession)(),I=x&&k?null===(t=k.data)||void 0===t?void 0:t.user.db.displayName:n.displayName,N=(0,m.useState)("profile"+n.id+g),S=N[0],L=N[1];return(0,m.useEffect)(function(){S!=="profile"+n.id+g&&(L("profile"+n.id+g),_(o.I5.Newest))},[n.id,g,S]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(M(),{children:[(0,a.jsx)("meta",{property:"og:image",content:(null==y?void 0:y.url)||n.image}),(0,a.jsx)("meta",{property:"og:image:type",content:"image/png"}),(0,a.jsx)("meta",{property:"og:image:alt",content:"Playground AI"}),(0,a.jsx)("title",{children:"".concat(I," - Playground AI")}),(0,a.jsx)("meta",{property:"og:title",content:"".concat(I," - Playground AI")}),(0,a.jsx)("meta",{property:"twitter:card",content:"summary_large_image"}),(0,a.jsx)("meta",{property:"twitter:title",content:"".concat(I," - Playground AI")}),(0,a.jsx)("meta",{property:"twitter:image",content:(null==y?void 0:y.url)||n.image}),(0,a.jsx)("meta",{property:"twitter:description",content:"View images"}),(0,a.jsx)("meta",{property:"twitter:url",content:"https://playgroundai.com".concat((0,O.useRouter)().asPath)})]}),(0,a.jsxs)(l.Z,{disableTitle:!0,children:[n.disabled&&(0,a.jsx)("div",{className:"bg-orange-400 text-white font-bold p-1 px-8",children:"This user is disabled and is not visible publicly"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{userId:n.id,name:I,avatar:n.image,followerIds:u,followingIds:h,currentUserId:s,likeCount:i,userLink:n.link,isOwnProfile:x},n.id),(0,a.jsx)(E,{userId:n.id,tab:g,sortBy:w,showTabs:x,setSortBy:function(e){Object.values(o.I5).includes(e)?_(e):console.error("Invalid sort by value: ",e)}}),(0,a.jsx)("div",{id:"scroll-container",className:"".concat(d().profile__images),ref:v,children:(0,a.jsx)(f.Z,{initialImages:r,initialCursor:p,options:{url:"/api/images/user",params:{id:n.id,likedImages:g===o.Dt.Likes,sortBy:w}},sortBy:w,groupBatchedImages:!0,hideProfileImages:!0},S)})]})]})]})}var D=null,A=null,T=null,q=null;function F(){return(F=(0,r.Z)(function(){var e,t;return(0,s.__generator)(this,function(r){switch(r.label){case 0:if(D)return[3,3];return[4,Promise.all([n.e(385),n.e(859)]).then(n.bind(n,2859))];case 1:return D=(e=r.sent()).getImagesByUser,A=e.getLikedImagesByUser,[4,Promise.all([n.e(385),n.e(818)]).then(n.bind(n,3818))];case 2:T=(t=r.sent()).getUserLikeCount,q=t.getUserProfile,r.label=3;case 3:return[2]}})})).apply(this,arguments)}function K(e,t){return V.apply(this,arguments)}function V(){return(V=(0,r.Z)(function(e,t){var n,r,a,l,u,d,f,m,p,g,x,v,y,j,w,b,_,k,I;return(0,s.__generator)(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),[4,function(){return F.apply(this,arguments)}()];case 1:if(s.sent(),!(l=e.query.id))throw Error("Missing user id");return[4,(0,c.getSession)({req:e.req})];case 2:return m=(f=null!==(d=null==(u=s.sent())?void 0:null===(n=u.user)||void 0===n?void 0:n.id)&&void 0!==d?d:null)===l,p=q(l),g=f===l,x=[],[4,Promise.all([p,x=t?A({userId:l,limit:h.NM,cursor:0,includePrivate:g,sortBy:o.I5.Newest,session:u}):D({userId:l,limit:h.NM,cursor:0,includePrivate:g,session:u}),T(l)])];case 3:if(j=(y=i.Z.apply(void 0,[s.sent(),3]))[0],w=y[1],b=y[2],j.disabled&&(null==u?void 0:null===(r=u.user)||void 0===r?void 0:r.db.role)!=="ADMIN")return[2,{redirect:{permanent:!1,destination:"/disabled"}}];return k=(_=w.at(-1))&&_.sequence||0,[2,{props:{currentUserId:f,user:j,likeCount:b,followerIds:j.followers.map(function(e){return e.followerId}),followingIds:j.following.map(function(e){return e.followingId}),initialImages:JSON.parse(JSON.stringify(w)),initialCursor:k,sessionData:u,tab:t?o.Dt.Likes:o.Dt.Images,isOwnProfile:m}}];case 4:return I=s.sent(),console.log(I),[2,{notFound:!0}];case 5:return[2]}})})).apply(this,arguments)}},3344:function(e,t,n){"use strict";var r=n(7294),i=function(){var e=(0,r.useState)(!1),t=e[0],n=e[1];return(0,r.useEffect)(function(){n(!0)},[]),t};t.Z=i},8057:function(e){e.exports={profile__header_avatar:"Profile_profile__header_avatar__0BNHY",profile__header_friendship_count:"Profile_profile__header_friendship_count__7Gl8V",profile__images:"Profile_profile__images__UaXBB",profile__add_link_input:"Profile_profile__add_link_input__4LLXE"}}}]);