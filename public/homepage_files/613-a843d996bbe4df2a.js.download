(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{8181:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var r=n(7568),o=n(6042),i=n(9396),s=n(9815),l=n(655),a=n(5893),u=n(9830),c=n(9669),h=n.n(c),d=n(2337),p=n(7294),f=n(8533),m=n(628),v=n(3344),g=function(){var e=(0,v.Z)(),t=(0,p.useState)(0),n=t[0],r=t[1],o=(0,p.useCallback)(function(){e&&r(window.innerWidth)},[e]);return(0,p.useLayoutEffect)(function(){if(e)return window.addEventListener("resize",o),o(),function(){return window.removeEventListener("resize",o)}},[e,o]),{width:n,hasMounted:e}},w=function(e){var t=e.columnsCountBreakPoints,n=e.children,r=e.className,o=e.style,i=g(),s=i.width,l=i.hasMounted,u=(0,p.useMemo)(function(){var e=Object.keys(t).sort(function(e,t){return parseInt(e)-parseInt(t)}),n=e.length>0?t[e[0]]:1;return e.forEach(function(e){parseInt(e)<s&&(n=t[e])}),n},[s,t]);return(0,a.jsx)("div",{className:r,style:o,children:l?p.Children.map(n,function(e,t){return p.cloneElement(e,{key:t,columnsCount:u})}):null})},y=n(1163),E=n(4108),T=n(3299),b={300:1,400:2,800:3,1200:4,1600:5};function _(e){var t,n,c,g=e.initialImages,_=e.initialCursor,S=e.options,L=e.sortBy,x=e.emptyState,D=e.groupBatchedImages,M=void 0!==D&&D,C=e.hideProfileImages,Y=void 0!==C&&C,P=e.scrollThreshold,k=(0,p.useState)(g),R=k[0],I=k[1],Z=(0,p.useState)(_),B=Z[0],N=Z[1],j=(0,p.useState)(!1),O=j[0],A=j[1],F=(0,p.useState)(null),H=F[0],q=F[1],z=(0,T.useSession)(),U=(0,y.useRouter)(),W=(0,p.useRef)({sortBy:L}),V=(0,E.g)().setImageData;(0,p.useEffect)(function(){var e,t=!1,n=(e=(0,r.Z)(function(){var e,n,r;return(0,l.__generator)(this,function(o){switch(o.label){case 0:return A(!0),[4,G(0)];case 1:return n=(e=o.sent()).newImages,r=e.newCursor,t||(N(r),I(n),A(!1)),[2]}})}),function(){return e.apply(this,arguments)});return W.current.sortBy!==L&&(W.current.sortBy=null,n()),function(){t=!0}},[L]);var $,K,G=(0,p.useCallback)((c=(0,r.Z)(function(e){var t,n,r,i,s,a;return(0,l.__generator)(this,function(r){switch(r.label){case 0:return[4,h().get(S.url,{params:(0,o.Z)({limit:u.NM,cursor:e,userId:null==z?void 0:null===(t=z.data)||void 0===t?void 0:null===(n=t.user)||void 0===n?void 0:n.id},S.params)})];case 1:return[2,{newImages:s=(i=r.sent().data).images,newCursor:i.cursor}]}})}),function(e){return c.apply(this,arguments)}),[S.params,S.url,null==z?void 0:null===(t=z.data)||void 0===t?void 0:null===(n=t.user)||void 0===n?void 0:n.id]),J=(0,p.useCallback)((0,r.Z)(function(){var e,t,n;return(0,l.__generator)(this,function(n){switch(n.label){case 0:return[4,G(B)];case 1:return t=(e=n.sent()).newImages,N(e.newCursor),setTimeout(function(){return I(function(e){return(0,s.Z)(e).concat((0,s.Z)(t))})},0),[2,t]}})}),[B,G]),Q=(0,p.useCallback)(($=(0,r.Z)(function(e,t){var n,r,o,i=arguments;return(0,l.__generator)(this,function(s){return n=!(i.length>2)||void 0===i[2]||i[2],r=i.length>3&&void 0!==i[3]&&i[3],q(t),V(e),o=e.id,U.query.postId=o,r&&U.push(U,"/post/".concat(o),{shallow:!0}),n&&localStorage.setItem("modal-return-to",U.asPath),[2]})}),function(e,t){return $.apply(this,arguments)}),[U,V]),X=(0,v.Z)(),ee=(0,p.useMemo)(function(){var e=[];return R.forEach(function(t){if(!t.hide){var n=e.find(function(e){return e.id===t.batchId});n?n.images.length<4&&n.images.push(t):e.push({id:M&&t.batchId?t.batchId:t.id,images:[t]})}}),e},[R,M]),et=(0,p.useCallback)((K=(0,r.Z)(function(e){var t,n,r,o;return(0,l.__generator)(this,function(i){switch(i.label){case 0:if(!(null!==H)||((t=H+e)>=0&&t<R.length&&(null===(n=ee[t].images)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.id)&&Q(null===(o=ee[t].images)||void 0===o?void 0:o[0],t,!1,!0),!(t>=R.length-2)))return[3,2];return[4,J()];case 1:i.sent(),i.label=2;case 2:return[2]}})}),function(e){return K.apply(this,arguments)}),[ee,J,R.length,Q,H]);(0,p.useEffect)(function(){var e,t=(e=(0,r.Z)(function(e){var t;return(0,l.__generator)(this,function(n){return["ArrowLeft","ArrowRight"].includes(null===(t=e.key)||void 0===t?void 0:t.toString())&&(null==U?void 0:U.query.postId)&&et("ArrowRight"===e.key?1:-1),[2]})}),function(t){return e.apply(this,arguments)});return document.addEventListener("keydown",t),function(){document.removeEventListener("keydown",t)}},[R,et,null==U?void 0:U.query.postId,H]),(0,p.useEffect)(function(){var e=function(){return et(1)},t=function(){return et(-1)};return document.addEventListener("pai:modal:next",e),document.addEventListener("pai:modal:prev",t),function(){document.removeEventListener("pai:modal:next",e),document.removeEventListener("pai:modal:prev",t)}},[et]);var en=(0,p.useMemo)(function(){return R.some(function(e){return e.hide})},[R]);return X?(0,a.jsx)(f.Z,{dataLength:R.length,next:J,hasMore:void 0!==B,loader:(0,a.jsx)(a.Fragment,{}),style:{overflow:"visible"},scrollThreshold:void 0===P?.8:P,children:(0,a.jsx)(w,{columnsCountBreakPoints:b,children:ee.length&&!O?(0,a.jsx)(d.Z,{gutter:"16px",children:ee.map(function(e,t){var n=Math.min(e.images.length,2);return(0,a.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:"repeat(".concat(n,", minmax(0, 1fr))")},children:e.images.map(function(e,r){var s,l,u;return(0,a.jsx)(m.F,{id:e.id,aspectRatio:(null!==(s=e.width)&&void 0!==s?s:1)/(null!==(l=e.height)&&void 0!==l?l:1),prompt:n>1?"":e.prompt,url:null!==(u=e.url_jpeg)&&void 0!==u?u:e.url,title:e.title,isPrivate:e.private,source:e.source,user:{id:e.user.id,name:e.user.displayName,avatar:e.user.image},hideImage:Y,reaction:e.ImageReaction,onClick:function(n){n.metaKey||Q(e,t)},setHidden:function(t,n){var r=n||[e.id];I(function(e){return e.map(function(e){return r.includes(e.id)?(0,i.Z)((0,o.Z)({},e),{hide:t}):e})})},forceVisible:en,parent_image_url:e.parent_image_url},e.id)})},e.id)})}):(0,a.jsx)("p",{className:"text-gray-400 p-10",children:x||O||"No images."})})}):null}},3344:function(e,t,n){"use strict";var r=n(7294),o=function(){var e=(0,r.useState)(!1),t=e[0],n=e[1];return(0,r.useEffect)(function(){n(!0)},[]),t};t.Z=o},1174:function(e){e.exports={tabs:"Feed_tabs__Fl_xj"}},8533:function(e,t,n){"use strict";var r=n(7294),o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},s={Pixel:"Pixel",Percent:"Percent"},l={unit:s.Percent,value:.8};function a(e){return"number"==typeof e?{unit:s.Percent,value:100*e}:"string"==typeof e?e.match(/^(\d*(\.\d+)?)px$/)?{unit:s.Pixel,value:parseFloat(e)}:e.match(/^(\d*(\.\d+)?)%$/)?{unit:s.Percent,value:parseFloat(e)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),l):(console.warn("scrollThreshold should be string or number"),l)}var u=function(e){function t(t){var n=e.call(this,t)||this;return n.lastScrollTop=0,n.actionTriggered=!1,n.startY=0,n.currentY=0,n.dragging=!1,n.maxPullDownDistance=0,n.getScrollableTarget=function(){return n.props.scrollableTarget instanceof HTMLElement?n.props.scrollableTarget:"string"==typeof n.props.scrollableTarget?document.getElementById(n.props.scrollableTarget):(null===n.props.scrollableTarget&&console.warn("You are trying to pass scrollableTarget but it is null. This might\n        happen because the element may not have been added to DOM yet.\n        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.\n      "),null)},n.onStart=function(e){!n.lastScrollTop&&(n.dragging=!0,e instanceof MouseEvent?n.startY=e.pageY:e instanceof TouchEvent&&(n.startY=e.touches[0].pageY),n.currentY=n.startY,n._infScroll&&(n._infScroll.style.willChange="transform",n._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},n.onMove=function(e){if(n.dragging)e instanceof MouseEvent?n.currentY=e.pageY:e instanceof TouchEvent&&(n.currentY=e.touches[0].pageY),!(n.currentY<n.startY)&&(n.currentY-n.startY>=Number(n.props.pullDownToRefreshThreshold)&&n.setState({pullToRefreshThresholdBreached:!0}),!(n.currentY-n.startY>1.5*n.maxPullDownDistance)&&n._infScroll&&(n._infScroll.style.overflow="visible",n._infScroll.style.transform="translate3d(0px, "+(n.currentY-n.startY)+"px, 0px)"))},n.onEnd=function(){n.startY=0,n.currentY=0,n.dragging=!1,n.state.pullToRefreshThresholdBreached&&(n.props.refreshFunction&&n.props.refreshFunction(),n.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){n._infScroll&&(n._infScroll.style.overflow="auto",n._infScroll.style.transform="none",n._infScroll.style.willChange="unset")})},n.onScrollListener=function(e){"function"==typeof n.props.onScroll&&setTimeout(function(){return n.props.onScroll&&n.props.onScroll(e)},0);var t=n.props.height||n._scrollableNode?e.target:document.documentElement.scrollTop?document.documentElement:document.body;!n.actionTriggered&&((n.props.inverse?n.isElementAtTop(t,n.props.scrollThreshold):n.isElementAtBottom(t,n.props.scrollThreshold))&&n.props.hasMore&&(n.actionTriggered=!0,n.setState({showLoader:!0}),n.props.next&&n.props.next()),n.lastScrollTop=t.scrollTop)},n.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:t.dataLength},n.throttledOnScrollListener=(function(e,t,n,r){var o,i=!1,s=0;function l(){o&&clearTimeout(o)}function a(){var a=this,u=Date.now()-s,c=arguments;function h(){s=Date.now(),n.apply(a,c)}!i&&(r&&!o&&h(),l(),void 0===r&&u>e?h():!0!==t&&(o=setTimeout(r?function(){o=void 0}:h,void 0===r?e-u:e)))}return"boolean"!=typeof t&&(r=n,n=t,t=void 0),a.cancel=function(){l(),i=!0},a})(150,n.onScrollListener).bind(n),n.onStart=n.onStart.bind(n),n.onMove=n.onMove.bind(n),n.onEnd=n.onEnd.bind(n),n}return!function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.componentDidMount=function(){if(void 0===this.props.dataLength)throw Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),"number"==typeof this.props.initialScrollY&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),"function"!=typeof this.props.refreshFunction))throw Error('Mandatory prop "refreshFunction" missing.\n          Pull Down To Refresh functionality will not work\n          as expected. Check README.md for usage\'')},t.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},t.prototype.componentDidUpdate=function(e){this.props.dataLength!==e.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},t.getDerivedStateFromProps=function(e,t){return e.dataLength!==t.prevDataLength?i(i({},t),{prevDataLength:e.dataLength}):null},t.prototype.isElementAtTop=function(e,t){void 0===t&&(t=.8);var n=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,r=a(t);return r.unit===s.Pixel?e.scrollTop<=r.value+n-e.scrollHeight+1:e.scrollTop<=r.value/100+n-e.scrollHeight+1},t.prototype.isElementAtBottom=function(e,t){void 0===t&&(t=.8);var n=e===document.body||e===document.documentElement?window.screen.availHeight:e.clientHeight,r=a(t);return r.unit===s.Pixel?e.scrollTop+n>=e.scrollHeight-r.value:e.scrollTop+n>=r.value/100*e.scrollHeight},t.prototype.render=function(){var e=this,t=i({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),n=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),o=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return r.createElement("div",{style:o,className:"infinite-scroll-component__outerdiv"},r.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(t){return e._infScroll=t},style:t},this.props.pullDownToRefresh&&r.createElement("div",{style:{position:"relative"},ref:function(t){return e._pullDown=t}},r.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!n&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},t}(r.Component);t.Z=u}}]);